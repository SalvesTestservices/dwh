<% buttons = can?(:write, :users) ? [[I18n.t(".user.titles.new"), new_user_path]] : nil %>

<%= render "layouts/page_header", 
  breadcrumbs: @breadcrumbs, 
  title: I18n.t(".user.titles.index"), 
  icon: ["users", "medium", "gray"],
  buttons: buttons
%>

<%= render "users/header", view: @view %>

<main>
  <div class="mx-auto max-w-8xl py-2 md:py-6">

    <div class="bg-gray-50 rounded-lg p-4 my-3 border border-gray-300">
      <div class="min-w-full divide-y divide-gray-200">
        <div class="bg-gray-50 grid grid-cols-5">
          <%= render(DivTable::HeaderComponent.new(title: I18n.t(".activerecord.attributes.user.first_name"), align: "text-left")) %>
          <%= render(DivTable::HeaderComponent.new(title: I18n.t(".activerecord.attributes.user.last_name"), align: "text-left")) %>
          <%= render(DivTable::HeaderComponent.new(title: I18n.t(".activerecord.attributes.user.role"), align: "text-left")) %>
          <%= render(DivTable::HeaderComponent.new(title: I18n.t(".activerecord.attributes.user.email"), align: "text-left")) %>
          <%= render(DivTable::HeaderComponent.new(title: "", align: "text-center")) %>
        </div>

        <% if @users.blank? %>
          <div class="bg-white grid grid-cols-1">
            <div class="table-cell h-20 pt-7 whitespace-nowrap text-xm text-center text-gray-900"><%= I18n.t('.general.no_records') %></div>
          </div>
        <% else %>
          <% @users.each do |user| %>
            <% decorate user do |decorates| %>
              <div class="bg-white grid grid-cols-5 items-center">
                <%= render(DivTable::CellComponent.new(value: decorates.data_field(user.first_name), align: "text-left")) %>
                <%= render(DivTable::CellComponent.new(value: decorates.data_field(user.last_name), align: "text-left")) %>
                <%= render(DivTable::CellComponent.new(value: decorates.role, align: "text-left")) %>
                <%= render(DivTable::CellComponent.new(value: decorates.data_field(user.email), align: "text-left")) %>
                <div class="px-2 py-3 text-sm text-gray-700">
                  <div class="flex flex-row justify-center gap-2 w-full">
                    <% if can?(:write, :users) %>
                      <%= render(View::ButtonComponent.new(title: I18n.t(".general.edit").downcase, url: edit_user_path(current_user), button_type: "link", size: "small")) %>
                    <% end %>
                    <% if can?(:delete, :users) %>
                      <%= render(View::ButtonComponent.new(title: I18n.t(".general.destroy").downcase, url: user_path(current_user), button_type: "delete_button", size: "small")) %>
                    <% end %>
                  </div>
                </div>
              </div>
            <% end %>
          <% end %>
        <% end %>
      </div>
    </div>

    <div class="mt-10 md:flex md:items-center md:justify-between">
      <div class="min-w-0 flex-1">
        <h2 class="flex items-center gap-3 text-2xl/7 font-bold text-gray-700 sm:truncate sm:text-3xl sm:tracking-tight">
          <%= render(View::IconComponent.new(icon_type: "lock", size: "medium", color: "gray")) %>
          <%= I18n.t(".role.titles.index") %>
        </h2>
      </div>

      <% if can?(:write, :roles) %>
        <%= link_to I18n.t(".role.titles.new"), new_role_path, class: "whitespace-nowrap text-gray-700 bg-gray-100 hover:bg-gray-50 sm:h-10 mt-1 px-1 px-2 sm:px-4 py-2 text-sm mr-1 border border-gray-300 shadow-sm font-medium rounded" %>
      <% end %>
    </div>

    <%= render "roles/roles" %>

  </div>
</main>